--- sys/src/9/port/devmouse.c	Sun Oct 31 00:54:49 2004
+++ sys/src/9/port/devmouse.c	Sun Oct 31 00:54:49 2004
@@ -47,6 +47,7 @@
 enum
 {
 	CMbuttonmap,
+	CMscrollswap,
 	CMswap,
 	CMwildcard,
 };
@@ -54,6 +55,7 @@
 static Cmdtab mousectlmsg[] =
 {
 	CMbuttonmap,	"buttonmap",	0,
+	CMscrollswap,	"scrollswap",	0,
 	CMswap,		"swap",		1,
 	CMwildcard,	"*",		0,
 };
@@ -87,7 +89,7 @@
 	0, 1, 2, 3, 4, 5, 6, 7,
 };
 static int mouseswap;
-
+static int scrollswap;
 extern	Memimage*	gscreen;
 
 static void
@@ -210,7 +212,7 @@
 static long
 mouseread(Chan *c, void *va, long n, vlong off)
 {
-	char buf[4*12+1];
+	char buf[1+4*12+1];
 	uchar *p;
 	static int map[8] = {0, 4, 2, 6, 1, 5, 3, 7 };
 	ulong offset = off;
@@ -265,7 +267,12 @@
 		b = buttonmap[m.buttons&7];
 		/* put buttons 4 and 5 back in */
 		b |= m.buttons & (3<<3);
-		sprint(buf, "m%11d %11d %11d %11lud",
+		if (scrollswap)
+			if (b == 8)
+				b = 16;
+			else if (b == 16)
+				b = 8;
+		sprint(buf, "m%11d %11d %11d %11lud ",
 			m.xy.x, m.xy.y,
 			b,
 			m.msec);
