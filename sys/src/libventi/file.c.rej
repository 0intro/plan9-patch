--- sys/src/libventi/file.c	Sun Jun 15 05:00:13 2008
+++ sys/src/libventi/file.c	Sun Jun 15 05:00:12 2008
@@ -607,7 +607,7 @@
 
 	rb = vtcacheglobal(r->c, e->score, e->type);
 	if(rb == nil)
-		return 0;
+		return -1;
 
 	/*
 	 * Walk down to the new root block.
@@ -1064,6 +1070,8 @@
 		return -1;
 
 	memmove(b->data+frag, data, count);
+	if(m == VtOWRITE && frag+count < e.dsize)
+		memset(b->data+frag+count, 0, e.dsize-frag-count);
 
 	if(offset+count > e.size){
 		vtfilegetentry(f, &e);
@@ -1124,9 +1132,12 @@
 		for(i=0; i<epb; i++){
 			if(vtentryunpack(&e, b->data, i) < 0)
 				goto Err;
+			if(!(e.flags&VtEntryActive))
+				continue;
 			if(flushblock(c, nil, e.score, e.psize/VtScoreSize, e.dsize/VtEntrySize,
 				e.type) < 0)
 				goto Err;
+			vtentrypack(&e, b->data, i);
 		}
 		break;
 	
