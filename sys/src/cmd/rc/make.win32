include ../make.$(objtype)

CFLAGS=-DWindows
LIBDIR=$(BIN)
TARG=rc.exe
YFLAGS=-d
OFILES=code.o exec.o getflags.o glob.o here.o io.o lex.o \
	pcmd.o pfnc.o simple.o subr.o trap.o tree.o var.o \
	y.tab.o haventfork.o win32.o
# CLEANFILES=y.tab.h y.tab.c x.tab.h

$(TARG): x.tab.h $(OFILES)
	$(CC) -o $@ $(OFILES)

y.tab.h y.tab.c: syn.y
	$(YACC) $(YFLAGS) syn.y

x.tab.h: y.tab.h
	cmp -s x.tab.h y.tab.h || cp y.tab.h x.tab.h

clean:
	rm -f *.o $(EXFLEAN)

nuke: clean
	rm -f $(TARG)

install: $(TARG)
	-rm $(BIN)/_$(TARG)
	-mv $(BIN)/$(TARG) $(BIN)/_$(TARG)
	cp $(TARG) $(BIN)/$(TARG)
	-rm $(BIN)/_$(TARG)
	cp rcmain.$(objtype) $(LIBDIR)/rcmain
